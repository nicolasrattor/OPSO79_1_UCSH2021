<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>OPSO79-1-UCSH2021</title>
    <meta charset="utf-8" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# OPSO79-1-UCSH2021
## Diseños de investigación e introducción a dplyr en R. Bloque práctico.
### <code>27/08/2021</code>

---











class: inverse, center, middle

# Nuestro mundo en datos (provación)


---

# Our World in data

`OurWorldInData` es una publicación en-línea que presenta datos y resultados empíricos que muestran el cambio en las condiciones de vida en todo mundo. 

--

Un estudiante de magíster en políticas públicas está desarrollando un [paquete en R](https://github.com/piersyork/owidR) para descargar y visualizar directamente estos datos. 

--

Como está en desarrollo aún no se encuentra en la CRAN. Si se quiere ocupar tiene que descargarse así:


```r
install.packages("devtools")

devtools::install_github("piersyork/owidR")

library(owidR)
```

--

Más adelante entenderemos bien. Por ahora veamos lo que nos permite hacer en [R Cloud](https://rstudio.cloud/project/2770951).

---

&lt;img src="imagenes/daza_pc.jpg" width="80%" style="display: block; margin: auto;" /&gt;


---
class: inverse, center, middle

# Un poco más de R base

---

# Insertar lenguaje R en .rmd

Hemos visto tres formas de interactuar con R:

--

+ Consola.


+ Script `.R`.


+ Script `.rmd` o `Rmarkdown`.

--

En la tarea práctica 1 ocupamos Rmarkdown, pero nos limitamos a escribir en texto plano.

--

Su verdadera potencia se expresa cuando combinamos texto con código. 

--

Para agregar un `chunk` o trozo de código de lenguaje R en RMarkdown: 

&lt;img src="imagenes/insert_chunk.png" width="80%" style="display: block; margin: auto;" /&gt;

---

# Insertar lenguaje R en .rmd

Aparecerá lo siguiente:

&lt;img src="imagenes/chunk.png" width="80%" style="display: block; margin: auto;" /&gt;

--

En el espacio interno podemos escribir código R:

&lt;img src="imagenes/Captura.png" width="80%" style="display: block; margin: auto;" /&gt;

---

# Algunos ejemplos


---

# Operadores lógicos

.medium.par[Los **operadores lógicos** son .medium-par-red[muy] importantes para la programación.]

--

**R** cuenta con operadores de comparación binaria.


```r
x &lt; y    # menor que
x &gt; y    # mayor que
x &lt;= y   # menor o igual que
x &gt;= y   # mayor o igual que
x == y   # igual a 
x != y   # distinto a
```

--

👀: Nota que `==` permite comparar si dos valores son iguales. Ten cuidado de **NO** usar `=` que es interpretado como un operador de asignación (es como usar **&lt;-**).

---

# Operadores lógicos

--

Algunos ejemplos con números:


```r
x &lt;- c(1,2,5)
y &lt;- c(4,4,3)
x == y
#&gt; [1] FALSE FALSE FALSE
x != y
#&gt; [1] TRUE TRUE TRUE
x &lt; y
#&gt; [1]  TRUE  TRUE FALSE
```

--

Otros operadores muy importantes son `|` (o) e `&amp;` (y)

--




```r
guaguas[guaguas$nombre=="Salvador" &amp;  
          (guaguas$anio==1972| guaguas$anio==1979),]
```

```
## # A tibble: 2 x 5
##    anio nombre   sexo      n proporcion
##   &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt; &lt;dbl&gt;      &lt;dbl&gt;
## 1  1972 Salvador M       183   0.000576
## 2  1979 Salvador M        59   0.000218
```


---

class: inverse, center, middle

# Introducción a paquete dplyr


---

# El paquete dplyr

.pull-left[

Instalar y cargar como cualquier otro paquete:

`install.packages("dplyr")`

`library(dplyr)`



]


.pull-left[
&lt;img src="https://github.com/rstudio/hex-stickers/raw/master/thumbs/dplyr.png" width="70%" /&gt;
]

---

# El paquete dplyr

Nos proporciona una "gramática" particular para manipular y aplicar funciones sobre bases de datos.

--

El paquete fue desarrollado por [Hadley Wickham](http://hadley.nz/) de RStudio. Todo lo que haremos con sus funciones se puede hacer con r base. 

&lt;img src="imagenes/hadley-wickham.jpg" width="50%" style="display: block; margin: auto;" /&gt;

--

Ocuparemos muchos de sus paquetes (ggplot, tidyr, haven, readxl, httr, lubridate, etc.).


---

# Manipulación básica

Revisaremos 5 verbos básicos de `dplyr`:

+ `select()`

+ `filter()`

+ `arrange()`

+ `rename()`

+ `mutate()`

--

Lo que nos permiten hacer se puede hacer en R base, pero nos simplificarán la vida. 


---

# select()

Nos permite seleccionar de forma intuitiva las columnas que indiquemos.

--


```r
select(data, columna)
```


--

Selecciona 1 columnas de la base `guaguas`:

--


```r
select(guaguas,nombre)
```

```
## # A tibble: 845,400 x 1
##    nombre
##    &lt;chr&gt; 
##  1 María 
##  2 José  
##  3 Juan  
##  4 Luis  
##  5 Rosa  
##  6 Ana   
##  7 Manuel
##  8 Olga  
##  9 Carlos
## 10 Pedro 
## # ... with 845,390 more rows
```

---

# select()

Podemos seleccionar más de una columna agregandolas como argumento

--


```r
select(guaguas,nombre,n)
```

```
## # A tibble: 845,400 x 2
##    nombre     n
##    &lt;chr&gt;  &lt;dbl&gt;
##  1 María   2130
##  2 José     984
##  3 Juan     636
##  4 Luis     631
##  5 Rosa     426
##  6 Ana      340
##  7 Manuel   326
##  8 Olga     289
##  9 Carlos   277
## 10 Pedro    269
## # ... with 845,390 more rows
```

---

# select()

E incluso reordenar las columnas, ocupando sus nombres o sus posiciones

--


```r
select(guaguas,5:1)
```

```
## # A tibble: 845,400 x 5
##    proporcion     n sexo  nombre  anio
##         &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt;
##  1     0.104   2130 F     María   1920
##  2     0.0483   984 M     José    1920
##  3     0.0312   636 M     Juan    1920
##  4     0.0310   631 M     Luis    1920
##  5     0.0209   426 F     Rosa    1920
##  6     0.0167   340 F     Ana     1920
##  7     0.0160   326 M     Manuel  1920
##  8     0.0142   289 F     Olga    1920
##  9     0.0136   277 M     Carlos  1920
## 10     0.0132   269 M     Pedro   1920
## # ... with 845,390 more rows
```

--


```r
guaguas[,c(5:1)] # Lo mismo con R base
```


---

# filter() 

Nos permite seleccionar las filas que indiquemos.

--

Para eso utilizamos los operadores lógicos ya revisados (&gt; , &lt; , &gt;=, &lt;=, ==, !=, &amp;, |)

--



```r
filter(data, condicion)
```

--


```r
filter(guaguas, anio==1960 &amp; nombre=="Fidel")
```

```
## # A tibble: 1 x 5
##    anio nombre sexo      n proporcion
##   &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt; &lt;dbl&gt;      &lt;dbl&gt;
## 1  1960 Fidel  M       118   0.000448
```

--

En R base es bastante más tedioso:

--


```r
guaguas[guaguas$anio==1960 &amp; guaguas$nombre=="Fidel",]
```


---

# filter() 

&lt;img src="https://raw.githubusercontent.com/allisonhorst/stats-illustrations/master/rstats-artwork/dplyr_filter.jpg" width="100%" style="display: block; margin: auto;" /&gt;

---

# arrange()

---

# rename()


---

# mutate() 

&lt;img src="imagenes/dplyr_mutate.png" width="80%" style="display: block; margin: auto;" /&gt;



---


# Operador pipe (tubo)

Solo si queda tiempo en la clase.

--

Es un operador de `magrittr` que se combina con los verbos de dplyr.

--

Se escribe `%&gt;%` (*pipe* o tubo).

--

El operador `%&gt;%` nos permite concatenar funciones, haciendo más sencilla la lectura del código. Se lee de izquierda a derecha. 

--

¿Como saber los nombres de las variables de la base de datos `guaguas`?

--


```r
names(guaguas)   ## la manera "tradicional" o R base  
```

```
## [1] "anio"       "nombre"     "sexo"       "n"          "proporcion"
```

--

Con pipes sería así:

--


```r
guaguas %&gt;% names()  ## el objeto primero, luego la función
```

```
## [1] "anio"       "nombre"     "sexo"       "n"          "proporcion"
```


---

# Pipes

Con pipes podemos concatenar funciones.

--



---

# Tarea práctica N°2 🏠 

Ocupa las herramientas de `dplyr` vistas en clase sobre la base `guaguas` para responder a las preguntas

--

+ Señalar cuantas personas con tu nombre nacieron el mismo año que tú.

--


+ Señalar cual fue el nombre más usado el año que tú naciste.

--

+ Guardar en un objeto nuevo los 10 nombres de mujer más usados el año que tú naciste.

--

+ Crea una nueva variable en el nuevo objeto que se llame "biblico". 

--

+ Determinar cuál de los siguientes tres nombres tiene mayores inscripciones a lo largo del tiempo (1920-2019): ¿María, Juan o José?

--

+ Crea dos nuevas bases de datos llamadas Salvador y Augusto. Cada una solo debe tener casos entre 1960 y 1990. Identifica en que año estuvo más de moda cada nombre.

---

### Recursos web utilizados

[Xaringan: Presentation Ninja, de Yihui Xie](https://github.com/yihui/xaringan). Para generar esta presentación.

[Ilustraciones de Allison Horst](https://github.com/allisonhorst/stats-illustrations)

### Para reforzar y seguir aprendiendo

[Administración de datos en R. ¿Qué es dplyr?](https://programminghistorian.org/es/lecciones/administracion-de-datos-en-r#qu%C3%A9-es-dplyr). 

Capítulo 5 libro ["Ciencia de Datos"](https://es.r4ds.hadley.nz/transform.html) de Hadley Wickham

[Operadores lógicos en R](https://bookdown.org/jboscomendoza/r-principiantes4/operadores-logicos.html)

[Otra explicación de las pipes](https://rsanchezs.gitbooks.io/rprogramming/content/chapter9/pipeline.html). 

### Bibliografía utilizada



&lt;a name=bib-Wickham2021&gt;&lt;/a&gt;[Wickham, H.](#cite-Wickham2021) (2021). _R
Para Ciencia de Datos_. URL:
[https://es.r4ds.hadley.nz/](https://es.r4ds.hadley.nz/).



    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
